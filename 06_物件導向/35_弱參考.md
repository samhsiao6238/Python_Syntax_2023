# 弱引用（weak reference）

## 說明

1. 在 Python中，物件是透過 `參考計數（reference count）` 來管理其生命週期，當物件的參考計數降到 `0` 時，它將被垃圾收集器回收，但在某些情境下，可能只想暫時持有物件的參考，而不影響其生命週期，此時就可以使用弱引用。

2. 例如有些緩存實現可能不想因為緩存而讓物件永久存在，這時便可使用 `weakref`。

## 範例

_示範如何使用`__slots__`與`weakref`_

1. 沒有使用 `__slots__`

```python
# 弱參考
import weakref

class MyClass:
    def __init__(self, value):
        self.value = value

# 建立物件
obj = MyClass(123)
# 建立弱引用，傳入物件
ref = weakref.ref(obj)
print(ref())

# 釋放原始物件
del obj
print(ref())
```
_觀察結果_
```bash
<__main__.MyClass object at 0x10d238e80>
None
```

2. 使用 `__slots__` 但未定義 `__weakref__`

```python
import weakref

class MyClass:
    __slots__ = ('value',)

    def __init__(self, value):
        self.value = value

obj = MyClass(123)
# 這行會拋出TypeError，因為 __slots__ 未定義 __weakref__
ref = weakref.ref(obj)
```

### 範例3: 使用 `__slots__` 且定義了 `__weakref__`

```python
import weakref

class MyClass:
    __slots__ = ('value', '__weakref__')

    def __init__(self, value):
        self.value = value

obj = MyClass(123)
ref = weakref.ref(obj)  # 現在可以成功建立弱引用
print(ref())  # 輸出: <__main__.MyClass object at 0x10d238e80>

del obj
print(ref())  # 輸出: None
```

如上，當我們在類中使用`__slots__`時，如果想使用`weakref`，則必須在`__slots__`中加入`__weakref__`。