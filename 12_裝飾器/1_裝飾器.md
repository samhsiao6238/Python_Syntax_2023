# 裝飾器 `Decorators`

<br>

## 基本介紹

1. Python 的裝飾器用 `@` 符號表示。
2. 裝飾器提供一種簡潔的語法，可在不修改原始程式碼的情況下，用來 `修改或增強` 函數或類別的功能。
3. 本質上，裝飾器是一個函數，它接受一個函數作為參數，並返回另一個函數，這使得裝飾器具有高度的靈活性。
4. 範例說明

    ```python
    # 定義一個裝飾器
    def my_decorator(func):
        # 裝飾器內建的功能
        def wrapper():
            print("發生在函式被呼叫之前的事情")
            # 呼叫原本的函式
            func()
            print("發生在函式被呼叫之後的事情")
        return wrapper

    # 使用裝飾器
    @my_decorator
    def say_hello():
        print("Hello!")

    # 呼叫被裝飾的函式
    say_hello()
    ```
    _計算結果_
    ```bash
    發生在函式被呼叫之前的事情
    Hello!
    發生在函式被呼叫之後的事情
    ```

<br>


## 使用情境

_以下將分為三種使用情境來說明_

1. 輸出日誌
2. 檢查參數類型
3. 計時

<br>

### 1. 輸出日誌

_使用裝飾器來輸出函式調用的相關日誌。_

<br>

#### 範例

1. 使用裝飾器可以自動記錄函式的調用情況，包括參數、返回值等。
2. 裝飾器 log 會在函式被調用時記錄其名稱和傳遞的參數。

    ```python
    # 導入 logging 模組
    import logging

    # 設定logging的基本設定
    def log(func):
        def wrapper(*args, **kwargs):
            logging.debug(f'Running {func.__name__} with arguments {args} and kwargs {kwargs}')
            return func(*args, **kwargs)
        return wrapper

    # 語法糖
    @log
    def add(x, y):
        return x + y

    # 呼叫函式，設定logging的等級，只會印出DEBUG等級的訊息
    logging.basicConfig(level=logging.DEBUG)

    # 印出結果
    print(add(2, 3))
    ```

    _計算結果_
    ```bash
    DEBUG:root:Running add with arguments (2, 3) and kwargs {}
    5
    ```

<br>

### 2. 檢查參數類型

_透過裝飾器，可以在函數被調用前先檢查其參數的類型，確保其符合預期。_


<br>

#### 範例

1. 使用 `check_types` 裝飾器檢查函數參數的類型。

    ```python
    def check_types(types):
        def decorator(func):
            def wrapper(*args):
                for arg, t in zip(args, types):
                    if not isinstance(arg, t):
                        raise ValueError(f'Argument {arg} is not of {t}')
                return func(*args)
            return wrapper
        return decorator

    @check_types((int, int))
    def add(x, y):
        return x + y

    print(add(2, 3))  # 正確
    #
    try:
        print(add('hello', 3))  # 會引發錯誤
    except ValueError as e:
        print(e)
    ```

    _計算結果_
    ```
    5
    Argument hello is not of <class 'int'>
    ```



<br>

### 3. 計時

_用裝飾器來測量函數的執行時間。_

<br>


#### 範例

1. timer 裝飾器用於計算並印出函數的執行時間。

    ```python
    import time

    def timer(func):
        def wrapper(*args, **kwargs):
            start_time = time.time()
            result = func(*args, **kwargs)
            end_time = time.time()
            print(f'Function {func.__name__} took {end_time - start_time} seconds to run.')
            return result
        return wrapper

    @timer
    def sleep(n):
        time.sleep(n)

    sleep(2)
    ```
    
    _計算結果_
    ```bash
    Function sleep took 2.015591859817505 seconds to run.
    ```

<br>

---

_END_
