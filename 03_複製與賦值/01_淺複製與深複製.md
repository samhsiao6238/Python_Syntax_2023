# 淺複製、深複製

## 淺複製

### 淺複製的方式

- 調用 Python 內建模組 copy 中的 copy() 方法。

- 列表（list）除了可調用 copy.copy() 進行淺複製，還可透過類別自帶的方法 copy() 進行物件淺複製。

- 對序列類型物件（如 list、tuple、str）進行切片也會進行淺複製（關於切片詳見指定章節）。

- 透過列表生成式進行淺複製。

### 淺複製的說明

- 無論物件的本身是可變或是不可變類型，淺複製都會完整複製一個全新物件，複製後的內容相同但 id 不同。

- 無論容器內的元素是可變或不可變，淺複製將會完全複製並保有對原物件所有元素的引用。

- 當試圖修改淺複製物件中不可變元素的值，因為不可變特性將會建立新的元素，並且不影響原物件與其元素。

- 當試圖修改淺複製物件中的可變元素，因為可變特性將不會建立新物件，所以兩個物件將會同步改變。

### 淺複製的範例


```python
# 建立一個列表
numbers_1 = [1, 2, 3, [4, 5, 6], (7, 8, 9)]
# 淺複製
numbers_2 = numbers_1.copy()
# 查看 numbers_1 和 numbers_2 的 id 及內容
print('(1) numbers_1 和 numbers_2 的 id 及內容：')
print(id(numbers_1), numbers_1)
print(id(numbers_2), numbers_2)
# 容器內的不可變物件的 id 與內容
print('\n(2) 容器內的不可變物件的 id 與內容：')
print(id(numbers_1[0]), numbers_1[0])
print(id(numbers_2[0]), numbers_2[0])
# 容器內的可變物件的 id 與內容
print('\n(3) 容器內的可變物件的 id 與內容：')
print(id(numbers_1[3]), numbers_1[3])
print(id(numbers_2[3]), numbers_2[3])
```

```
    (1) numbers_1 和 numbers_2 的 id 及內容：
    140644349177280 [1, 2, 3, [4, 5, 6], (7, 8, 9)]
    140644349177984 [1, 2, 3, [4, 5, 6], (7, 8, 9)]
    
    (2) 容器內的不可變物件的 id 與內容：
    140644341416176 1
    140644341416176 1
    
    (3) 容器內的可變物件的 id 與內容：
    140644349179392 [4, 5, 6]
    140644349179392 [4, 5, 6]
```


```python
# 建立一個列表，包含整數、列表、數組
numbers_1 = [1, 2, 3, [4, 5, 6], (7, 8, 9)]
# 淺複製
numbers_2 = numbers_1.copy()

print('【說明】無論容器內的元素是可變或不可變，淺複製將會完全複製並保有對原物件所有元素的引用。')
print('(1) 逐一比較兩物件全部元素的 id 是否相同：')
# 遍歷每一個元素
for i in range(len(numbers_1)):
    # 檢查頂層元素的 id 是否相同
    print(id(numbers_1[i]) == id(numbers_2[i]), end=' ')

    # 如果元素是列表或數組，則檢查其內部元素的 id 是否相同
    if isinstance(numbers_1[i], (list, tuple)):
        # 加入分隔符號來分隔頂層元素與內部元素的比較結果
        print(':', end=' ')  
        for j in range(len(numbers_1[i])):
            print(id(numbers_1[i][j]) == id(numbers_2[i][j]), end=' ')
    # 換行以區隔不同的元素
    print('')  
```

```
    【說明】無論容器內的元素是可變或不可變，淺複製將會完全複製並保有對原物件所有元素的引用。
    (1) 逐一比較兩物件全部元素的 id 是否相同：
    True 
    True 
    True 
    True : True True True 
    True : True True True 
```


```python
# 建立一個列表，包含整數、列表、數組
numbers_1 = [1, 2, 3, [4, 5, 6], (7, 8, 9)]
# 淺複製
numbers_2 = numbers_1.copy()
# 複製後，輸出兩物件的 id 與內容
print('(1) 複製後，輸出兩物件的 id 與內容：')
print(id(numbers_1), numbers_1)
print(id(numbers_2), numbers_2)
# 後續要對第一個元素 numbers_1[0] 進行修改，因此輸出其 id 與內容進行觀察
print('\n(2) 後續要對第一個元素 numbers_1[0] 進行修改，因此輸出其 id 與內容進行觀察：')
print('【說明】id 相同，內容相同')
print(id(numbers_1[0]), numbers_1[0])
print(id(numbers_2[0]), numbers_2[0])

# 修改第一個元素 numbers_1[0] 並觀察兩物件的 id 與 內容變化
# 物件本身為可變物件，因此其 id 不變，
numbers_1[0] = 999
print('\n(3) 修改第一個元素 numbers_1[0] 並觀察兩物件的 id 與 內容變化：')
print('【說明】id 與原本相同')
print(id(numbers_1), numbers_1)
print(id(numbers_2), numbers_2)
# 觀察所修改的元素的 id 與內容
print('\n(4) 觀察所修改的元素的 id 與內容：')
print('【說明】被修改的元素 id 與值皆改變')
print(id(numbers_1[0]), numbers_1[0])
print(id(numbers_2[0]), numbers_2[0])

```

```
    (1) 複製後，輸出兩物件的 id 與內容：
    140644348814592 [1, 2, 3, [4, 5, 6], (7, 8, 9)]
    140643943639296 [1, 2, 3, [4, 5, 6], (7, 8, 9)]
    
    (2) 後續要對第一個元素 numbers_1[0] 進行修改，因此輸出其 id 與內容進行觀察：
    【說明】id 相同，內容相同
    140644341416176 1
    140644341416176 1
    
    (3) 修改第一個元素 numbers_1[0] 並觀察兩物件的 id 與 內容變化：
    【說明】id 與原本相同
    140644348814592 [999, 2, 3, [4, 5, 6], (7, 8, 9)]
    140643943639296 [1, 2, 3, [4, 5, 6], (7, 8, 9)]
    
    (4) 觀察所修改的元素的 id 與內容：
    【說明】被修改的元素 id 與值皆改變
    140643405067376 999
    140644341416176 1
```


```python
# 對列表進行淺複製，並修改其中可變物件的元素
print('【說明】對列表進行淺複製，並修改其中可變物件的元素')
# 建立一個列表，包含整數、列表、數組
numbers_1 = [1, 2, 3, [4, 5, 6], (7, 8, 9)]
# 淺複製
numbers_2 = numbers_1.copy()

# 複製後，輸出兩物件的 id 與內容
print('\n(1) 複製後，輸出兩物件的 id 與內容：')
print(id(numbers_1), numbers_1)
print(id(numbers_2), numbers_2)

# 修改第四個元素 numbers_1[3] 並觀察兩物件的 id 與 內容變化
print('\n(2) 修改第四個元素 numbers_1[3] 並觀察兩物件的 id 與 內容變化：')
print('【說明】淺複製會複製全部的引用，當修改可變元素時，兩物件的值都會改變')
numbers_1[3][0] = 999
print(id(numbers_1), numbers_1)
print(id(numbers_2), numbers_2)
```

```
    【說明】對列表進行淺複製，並修改其中可變物件的元素
    
    (1) 複製後，輸出兩物件的 id 與內容：
    140643943936704 [1, 2, 3, [4, 5, 6], (7, 8, 9)]
    140643281009664 [1, 2, 3, [4, 5, 6], (7, 8, 9)]
    
    (2) 修改第四個元素 numbers_1[3] 並觀察兩物件的 id 與 內容變化：
    【說明】淺複製會複製全部的引用，當修改可變元素時，兩物件的值都會改變
    140643943936704 [1, 2, 3, [999, 5, 6], (7, 8, 9)]
    140643281009664 [1, 2, 3, [999, 5, 6], (7, 8, 9)]
```


```python
# 改用 copy.copy() 進行淺複製
print('【說明】改用 copy.copy() 進行淺複製：')
# 導入 copy 模組
import copy
# 建立一個列表，包含整數、列表、數組
numbers_1 = [1, 2, 3, [4, 5, 6], (7, 8, 9)]
# 淺複製
numbers_2 = copy.copy(numbers_1)

# 複製後，輸出兩物件的 id 與內容
print('\n(1) 複製後，輸出兩物件的 id 與內容：')
print('【說明】id 不同，但內容相同')
print(id(numbers_1), numbers_1)
print(id(numbers_2), numbers_2)

# 後續要對第一個元素 numbers_1[0] 進行修改，因此輸出其 id 與內容進行觀察
print('\n(2) 後續要對第一個元素 numbers_1[0] 進行修改，因此輸出其 id 與內容進行觀察：')
print('【說明】id 相同，內容相同')
print(id(numbers_1[0]), numbers_1[0])
print(id(numbers_2[0]), numbers_2[0])

# 修改第一個元素 numbers_1[0] 並觀察兩物件的 id 與 內容變化
# 物件本身為可變物件，因此其 id 不變
numbers_1[0] = 999
print('\n(3) 修改第一個元素 numbers_1[0] 並觀察兩物件的 id 與 內容變化：')
print('【說明】id 與原本相同')
print(id(numbers_1), numbers_1)
print(id(numbers_2), numbers_2)

# 觀察所修改的元素的 id 與內容
print('\n(4) 觀察所修改的元素的 id 與內容：')
print('【說明】被修改的元素 id 與值皆改變')
print(id(numbers_1[0]), numbers_1[0])
print(id(numbers_2[0]), numbers_2[0])
```

```
    【說明】改用 copy.copy() 進行淺複製：
    
    (1) 複製後，輸出兩物件的 id 與內容：
    【說明】id 不同，但內容相同
    140643943938432 [1, 2, 3, [4, 5, 6], (7, 8, 9)]
    140643405746368 [1, 2, 3, [4, 5, 6], (7, 8, 9)]
    
    (2) 後續要對第一個元素 numbers_1[0] 進行修改，因此輸出其 id 與內容進行觀察：
    【說明】id 相同，內容相同
    140644341416176 1
    140644341416176 1
    
    (3) 修改第一個元素 numbers_1[0] 並觀察兩物件的 id 與 內容變化：
    【說明】id 與原本相同
    140643943938432 [999, 2, 3, [4, 5, 6], (7, 8, 9)]
    140643405746368 [1, 2, 3, [4, 5, 6], (7, 8, 9)]
    
    (4) 觀察所修改的元素的 id 與內容：
    【說明】被修改的元素 id 與值皆改變
    140643405054352 999
    140644341416176 1
```

## 深複製

### 深複製的方法

- 調用 Python 內建模組 copy 中的 deepcopy() 方法深複製物件。

### 深複製的說明

- 進行深複製時會完整複製原物件內容。

- 新舊物件及其所有元素都是完全獨立的，但特別注意，所謂的完全獨立並不代表複製完成時他們是完全沒有關連，其中在 id 的部分會依照資料類型不同而有不同處理規則。

- 新物件中的不可變類型資料仍將參考原物件，這是因為不可變物件在下一次被修改時本就會建立新物件，所以在尚未變更時，基於效能與系統資源考量並無立即建立新物件的必要。

- 新物件中的可變類型元素的會是全新物件並擁有不同參考(id)，但其高維度內的不可變類型資料仍將保有援物件的參考。

### 深複製的範例


```python
import copy
# 建立一個列表，包含整數、列表、數組
numbers_1 = [1, 2, 3, [[4, 4, 4], 5, 6], (7, 8, 9)]
# 深複製
numbers_2 = copy.deepcopy(numbers_1)

# 複製後，輸出兩物件的 id 與內容
print('\n(1) 深複製後，輸出兩物件的 id 與內容：')
print('【說明】深複製會複製完整全新物件，所以物件的 id 不同，但內容相同')
print(id(numbers_1), numbers_1)
print(id(numbers_2), numbers_2)


print('\n(2) 逐一比較兩物件全部元素的 id 是否相同：')
print('【說明】無論物件內的元素是可變或不可變，都會被完整複製')
print('【說明】其中可變元素將擁有新的 id，比較結果如下：')
# 遍歷每一個元素
for i in range(len(numbers_1)):
    # 檢查頂層元素的 id 是否相同
    print(id(numbers_1[i]) == id(numbers_2[i]), end=' ')

    # 如果元素是列表或數組，則檢查其內部元素的 id 是否相同
    if isinstance(numbers_1[i], (list, tuple)):
        # 加入分隔符號來分隔頂層元素與內部元素的比較結果
        print(':', end=' ')  
        for j in range(len(numbers_1[i])):
            print(id(numbers_1[i][j]) == id(numbers_2[i][j]), end=' ')
    # 換行以區隔不同的元素
    print('')  
```

```
    (1) 深複製後，輸出兩物件的 id 與內容：
    【說明】深複製會複製完整全新物件，所以物件的 id 不同，但內容相同
    140643943961920 [1, 2, 3, [[4, 4, 4], 5, 6], (7, 8, 9)]
    140643280766016 [1, 2, 3, [[4, 4, 4], 5, 6], (7, 8, 9)]
    
    (2) 逐一比較兩物件全部元素的 id 是否相同：
    【說明】無論物件內的元素是可變或不可變，都會被完整複製
    【說明】其中可變元素將擁有新的 id，比較結果如下：
    True 
    True 
    True 
    False : False True True 
    True : True True True 
```


```python
# 建立一個列表，包含整數、列表、數組
numbers_1 = [1, 2, 3, [[4, 4, 4], 5, 6], (7, 8, 9)]
# 深複製
numbers_2 = copy.deepcopy(numbers_1)

# 輸出第四個元素 numbers_1[3] 的 id 與內容
print('\n(1) 輸出第四個元素 numbers_1[3] 的 id 與內容：')
print('【說明】這是可變元素，所以深複製後 id 不同，但內容相同')
print(id(numbers_1[3]), numbers_1[3])
print(id(numbers_2[3]), numbers_2[3])

# 輸出第三個元素 numbers_1[2] 的 id 與內容
print('\n(2) 輸出第三個元素 numbers_1[2] 的 id 與內容：')
print('【說明】這是不可變元素，所以深複製後 id 相同，內容相同')
print(id(numbers_1[2]), numbers_1[2])
print(id(numbers_2[2]), numbers_2[2])

# 對第四個元素 numbers_1[3] 進行修改，並觀察兩物件的 id 與 內容變化
print('\n(3) 對第四個元素 numbers_1[3] 進行修改，並觀察兩物件的 id 與 內容變化：')
print('【說明】深複製會複製完整全新物件，所以物件的 id 不同，但內容相同')
numbers_1[3][0][0] = 999
print(id(numbers_1), numbers_1)
print(id(numbers_2), numbers_2)
```

```
    (1) 輸出第四個元素 numbers_1[3] 的 id 與內容：
    【說明】這是可變元素，所以深複製後 id 不同，但內容相同
    140644349179392 [[4, 4, 4], 5, 6]
    140643279231872 [[4, 4, 4], 5, 6]
    
    (2) 輸出第三個元素 numbers_1[2] 的 id 與內容：
    【說明】這是不可變元素，所以深複製後 id 相同，內容相同
    140644341416240 3
    140644341416240 3
    
    (3) 對第四個元素 numbers_1[3] 進行修改，並觀察兩物件的 id 與 內容變化：
    【說明】深複製會複製完整全新物件，所以物件的 id 不同，但內容相同
    140643943624832 [1, 2, 3, [[999, 4, 4], 5, 6], (7, 8, 9)]
    140644349176832 [1, 2, 3, [[4, 4, 4], 5, 6], (7, 8, 9)]
```

---END---
